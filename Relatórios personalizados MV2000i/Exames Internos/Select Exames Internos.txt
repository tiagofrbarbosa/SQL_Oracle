SELECT item exame
       ,SUM (qt_encaixes_marcados) encaixes_marcados
       ,SUM (qt_consultas_marcadas) consultas_marcadas
       ,SUM (atend_realizado) atendimentos_realizados
  FROM (SELECT ia.ds_item_agendamento item,
               AC.CD_AGENDA_CENTRAL AGENDA,
			   NVL(ac.qt_atendimento, 0) qt_vagas,
               NVL (ac.qt_encaixes, 0) qt_encaixes,
               NVL (ac.qt_encaixes_marcados, 0) qt_encaixes_marcados,
               COUNT (ac.qt_marcados) qt_consultas_marcadas,
               COUNT (it.cd_atendimento) atend_realizado
          FROM dbamv.agenda_central ac,
               dbamv.it_agenda_central it,
               dbamv.item_agendamento ia
             WHERE ac.cd_agenda_central = it.cd_agenda_central(+)
               AND ac.dt_agenda BETWEEN '01-12-2013' AND '31-12-2013'
               AND ac.tp_agenda = 'I'
               AND it.cd_atendimento Is NOT null
               AND it.cd_item_agendamento = ia.cd_item_agendamento
               AND it.cd_atendimento IN (SELECT cd_atendimento
			                               FROM DBAMV.ATENDIME
										  WHERE ATENDIME.CD_MULTI_EMPRESA = 1
										    AND ATENDIME.TP_ATENDIMENTO = 'E'
											AND ATENDIME.DT_ATENDIMENTO BETWEEN '01-12-2013' AND '31-12-2013'
											and cd_ori_ate = 14
										  )
		GROUP BY AC.CD_AGENDA_CENTRAL,ia.ds_item_agendamento,ac.qt_atendimento,ac.qt_encaixes,ac.qt_encaixes_marcados,ac.qt_marcados
)
GROUP BY item


UNION all

/*NAO AGENDADO MAS TEM ATENDIMENTO ABERTO E PEDIDO SOLICITADO DE RAIO-X*/
SELECT  ' - '||e.ds_exa_rx EXAME,0 ENCAIXES_MARCADOS,0 CONSULTAS_MARCADAS, COUNT(*) ATENDIMENTOS_REALIZADOS
  FROM ped_rx P, EXA_rx e, itped_Rx i
 WHERE cd_atendimento IN ( SELECT atendime.cd_atendimento
			                 FROM DBAMV.atendime
                            WHERE cd_atendimento NOT IN ( SELECT it.cd_atendimento atend_realizado
									                        FROM dbamv.agenda_central ac,
                                                                 dbamv.it_agenda_central it,
                                                                 dbamv.item_agendamento ia
                                                           WHERE ac.cd_agenda_central = it.cd_agenda_central(+)
                                                             AND ac.dt_agenda BETWEEN '01-12-2013' AND '31-12-2013'
                                                             AND ac.tp_agenda = 'I'
                                                             AND it.cd_atendimento IS NOT NULL
                                                             AND it.cd_item_agendamento = ia.cd_item_agendamento
                                                             AND it.cd_atendimento IN (SELECT cd_atendimento
                                                      									 FROM DBAMV.atendime
                                                     									WHERE atendime.cd_multi_empresa = 1
									                                                      AND atendime.tp_atendimento = 'E'
                                     									                  AND atendime.dt_atendimento BETWEEN '01-12-2013' AND '31-12-2013'
									                                                      AND cd_ori_ate = 14
																						)
                                           				 )
                        	  AND TO_DATE (atendime.dt_atendimento, 'DD/MM/YYYY') BETWEEN TO_DATE ('01-12-2013', 'DD/MM/YYYY') AND TO_DATE ('31-12-2013', 'DD/MM/YYYY')
                              AND atendime.cd_multi_empresa = 1
                              AND atendime.tp_atendimento = 'E'
                              AND atendime.cd_ori_ate = 14
                           )
    AND e.cd_exa_rx = i.cd_exa_rx
    AND p.cd_ped_rx = i.cd_ped_rx
    GROUP BY e.ds_exa_rx

UNION ALL

/*NAO AGENDADO MAS TEM ATENDIMENTO ABERTO E PEDIDO SOLICITADO DE LABORATORIO*/
SELECT ' - EXAME LABORATORIAL'EXAME,0 ENCAIXES_MARCADOS,0 CONSULTAS_MARCADAS,COUNT(*)ATENDIMENTOS_REALIZADOS FROM (
SELECT  DISTINCT(CD_ATENDIMENTO)
  FROM DBAMV.ped_lab
 WHERE cd_atendimento in( SELECT ATENDIME.CD_ATENDIMENTO
                            FROM DBAMV.ATENDIME
                           WHERE CD_ATENDIMENTO NOT IN (SELECT it.cd_atendimento atend_realizado
                                                          FROM dbamv.agenda_central ac,
                                                               dbamv.it_agenda_central it,
                                                               dbamv.item_agendamento ia
                                                         WHERE ac.cd_agenda_central = it.cd_agenda_central(+)
                                                           AND ac.dt_agenda BETWEEN '01-12-2013' AND '31-12-2013'
                                                           AND ac.tp_agenda = 'I'
                                                           AND it.cd_atendimento Is NOT null
                                                           AND it.cd_item_agendamento = ia.cd_item_agendamento
                                                           AND it.cd_atendimento IN (SELECT cd_atendimento
                                                                                       FROM DBAMV.ATENDIME
                                                                                      WHERE ATENDIME.CD_MULTI_EMPRESA = 1
                                                                                        AND ATENDIME.TP_ATENDIMENTO = 'E'
                                                                                        AND ATENDIME.DT_ATENDIMENTO BETWEEN '01-12-2013' AND '31-12-2013'
                                                                                        and cd_ori_ate = 14                                                                                                                            )
                                                                                      )
                                                            AND to_date(ATENDIME.DT_ATENDIMENTO,'DD/MM/YYYY') BETWEEN To_Date('01-12-2013','DD/MM/YYYY') AND To_Date('31-12-2013','DD/MM/YYYY')
                                                            AND ATENDIME.CD_MULTI_EMPRESA = 1
                                                            AND ATENDIME.TP_ATENDIMENTO = 'E'
                                                            AND atendime.cd_ori_ate = 14
                                                           )
)
UNION ALL

/*nao agendado e que não tem nenhum pedido*/
SELECT ' - NAO POSSUI PEDIDO',0 ENCAIXES_MARCADOS,0 CONSULTAS_MARCADAS,COUNT(*)ATENDIMENTOS_REALIZADOS
  FROM ATENDIME
 WHERE CD_ATENDIMENTO NOT IN (SELECT  it.cd_atendimento atend_realizado
                                FROM dbamv.agenda_central ac, dbamv.it_agenda_central it, dbamv.item_agendamento ia
                               WHERE ac.cd_agenda_central = it.cd_agenda_central(+)
                                 AND ac.dt_agenda BETWEEN '01-12-2013' AND '31-12-2013'
                                 AND ac.tp_agenda = 'I'
                                 AND it.cd_atendimento Is NOT null
                                 AND it.cd_item_agendamento = ia.cd_item_agendamento
                                 AND it.cd_atendimento IN (SELECT cd_atendimento
                                                             FROM dbamv.ATENDIME
                                                            WHERE ATENDIME.CD_MULTI_EMPRESA = 1
                                                              AND ATENDIME.TP_ATENDIMENTO = 'E'
                                                              AND ATENDIME.DT_ATENDIMENTO BETWEEN '01-12-2013' AND '31-12-2013'
                                                              and cd_ori_ate = 14
                                                          )
                              )
   AND to_date(ATENDIME.DT_ATENDIMENTO,'DD/MM/YYYY') BETWEEN To_Date('01-12-2013','DD/MM/YYYY') AND To_Date('31-12-2013','DD/MM/YYYY')
   AND ATENDIME.CD_MULTI_EMPRESA = 1
   AND ATENDIME.TP_ATENDIMENTO = 'E'
   AND atendime.cd_ori_ate = 14
   /*NAO PEGA OS ATENDIMENTOS QUE POSSUE PEDIDO LABORATORIAL*/
   AND atendime.cd_atendimento NOT IN (SELECT DISTINCT cd_atendimento
                                         from DBAMV.ped_lab
                                        WHERE cd_atendimento in( SELECT ATENDIME.CD_ATENDIMENTO
                                                                   FROM DBAMV.ATENDIME
                                                                  WHERE CD_ATENDIMENTO NOT IN (SELECT it.cd_atendimento atend_realizado
                                                                                                 FROM dbamv.agenda_central ac,
                                                                                                      dbamv.it_agenda_central it,
                                                                                                      dbamv.item_agendamento ia
                                                                                                WHERE ac.cd_agenda_central = it.cd_agenda_central(+)
                                                                                                  AND ac.dt_agenda BETWEEN '01-12-2013' AND '31-12-2013'
                                                                                                  AND ac.tp_agenda = 'I'
                                                                                                  AND it.cd_atendimento Is NOT null
                                                                                                  AND it.cd_item_agendamento = ia.cd_item_agendamento
                                                                                                  AND it.cd_atendimento IN (SELECT cd_atendimento
                                                                                                                              FROM DBAMV.ATENDIME
                                                                                                                             WHERE ATENDIME.CD_MULTI_EMPRESA = 1
                                                                                                                               AND ATENDIME.TP_ATENDIMENTO = 'E'
                                                                                                                               AND ATENDIME.DT_ATENDIMENTO BETWEEN '01-12-2013' AND '31-12-2013'   and cd_ori_ate = 14
                                                                                                                            )
                                                                                               )
                                                                    AND to_date(ATENDIME.DT_ATENDIMENTO,'DD/MM/YYYY') BETWEEN To_Date('01-12-2013','DD/MM/YYYY') AND To_Date('31-12-2013','DD/MM/YYYY')
                                                                    AND ATENDIME.CD_MULTI_EMPRESA = 1
                                                                    AND ATENDIME.TP_ATENDIMENTO = 'E'
                                                                    AND atendime.cd_ori_ate = 14
                                                                  )
                                        )

   /*NAO PEGA OS ATENDIMENTOS QUE POSSUE PEDIDO DE RAIO-X*/
   AND atendime.cd_atendimento NOT IN (SELECT cd_atendimento
                                         FROM DBAMV.ped_rx
                                        WHERE cd_atendimento IN (SELECT ATENDIME.CD_ATENDIMENTO
                                                                   FROM DBAMV.ATENDIME
                                                                  WHERE CD_ATENDIMENTO NOT IN (SELECT it.cd_atendimento atend_realizado
                                                                                                 FROM dbamv.agenda_central ac,
                                                                                                      dbamv.it_agenda_central it,
                                                                                                      dbamv.item_agendamento ia
                                                                                                WHERE ac.cd_agenda_central = it.cd_agenda_central(+)
                                                                                                  AND ac.dt_agenda BETWEEN '01-12-2013' AND '31-12-2013'
                                                                                                  AND ac.tp_agenda = 'I'
                                                                                                  AND it.cd_atendimento Is NOT null
                                                                                                  AND it.cd_item_agendamento = ia.cd_item_agendamento
                                                                                                  AND it.cd_atendimento IN (SELECT cd_atendimento
                                                                                                                              FROM DBAMV.ATENDIME
                                                                                                                             WHERE ATENDIME.CD_MULTI_EMPRESA = 1
                                                                                                                               AND ATENDIME.TP_ATENDIMENTO = 'E'
                                                                                                                               AND ATENDIME.DT_ATENDIMENTO BETWEEN '01-12-2013' AND '31-12-2013'
                                                                                                                               and cd_ori_ate = 14
                                                                                                                            )
                                                                                                )
                                        AND to_date(ATENDIME.DT_ATENDIMENTO,'DD/MM/YYYY') BETWEEN To_Date('01-12-2013','DD/MM/YYYY') AND To_Date('31-12-2013','DD/MM/YYYY')
                                        AND ATENDIME.CD_MULTI_EMPRESA = 1
                                        AND ATENDIME.TP_ATENDIMENTO = 'E'
                                        AND atendime.cd_ori_ate = 14
                                        )

)
ORDER BY 1 asc
