SELECT A.CD_ORI_ATE,
       ORI.DS_ORI_ATE,
       A.DT_ATENDIMENTO,
      PRE.NM_PRESTADOR,
       A.CD_ATENDIMENTO,
       A.CD_PACIENTE,
       P.NM_PACIENTE,
       (SELECT DS_TIP_RES FROM TIP_RES WHERE CD_TIP_RES = A.CD_TIP_RES) ALTA,
       (SELECT COUNT(TP.DS_TIP_PRESC) FROM PRE_MED P, ITPRE_MED IT, TIP_PRESC TP WHERE IT.CD_PRE_MED = P.CD_PRE_MED AND IT.CD_TIP_PRESC = TP.CD_TIP_PRESC AND P.CD_ATENDIMENTO = A.CD_ATENDIMENTO) EXA_LAB,
       (SELECT count(VDIC_RESPOSTA_DOCUMENTO.REGISTRO_DOCUMENTO) TOTAL FROM VDIC_RESPOSTA_DOCUMENTO,ATENDIME WHERE ATENDIME.CD_ATENDIMENTO = VDIC_RESPOSTA_DOCUMENTO.ATENDIMENTO AND ATENDIME.CD_MULTI_EMPRESA = 1 AND VDIC_RESPOSTA_DOCUMENTO.DOCUMENTO_PRONTUARIO IN(89,90) AND ATENDIME.CD_ATENDIMENTO = A.CD_ATENDIMENTO) APAC,
       (SELECT count(VDIC_RESPOSTA_DOCUMENTO.REGISTRO_DOCUMENTO) FROM VDIC_RESPOSTA_DOCUMENTO, ATENDIME WHERE ATENDIME.CD_ATENDIMENTO = VDIC_RESPOSTA_DOCUMENTO.ATENDIMENTO AND ATENDIME.CD_MULTI_EMPRESA = 1 AND VDIC_RESPOSTA_DOCUMENTO.DOCUMENTO_PRONTUARIO IN(111,294, 439) AND ATENDIME.CD_ATENDIMENTO = A.CD_ATENDIMENTO) SADT,
(SELECT count(VDIC_RESPOSTA_DOCUMENTO.REGISTRO_DOCUMENTO) FROM VDIC_RESPOSTA_DOCUMENTO, ATENDIME WHERE ATENDIME.CD_ATENDIMENTO = VDIC_RESPOSTA_DOCUMENTO.ATENDIMENTO AND ATENDIME.CD_MULTI_EMPRESA = 1 AND VDIC_RESPOSTA_DOCUMENTO.DOCUMENTO_PRONTUARIO IN(121, 295) AND ATENDIME.CD_ATENDIMENTO = A.CD_ATENDIMENTO) ENCAMINHAMENTO,
       (SELECT count(VDIC_RESPOSTA_DOCUMENTO.REGISTRO_DOCUMENTO) FROM VDIC_RESPOSTA_DOCUMENTO, ATENDIME WHERE ATENDIME.CD_ATENDIMENTO = VDIC_RESPOSTA_DOCUMENTO.ATENDIMENTO AND ATENDIME.CD_MULTI_EMPRESA = 1 AND VDIC_RESPOSTA_DOCUMENTO.DOCUMENTO_PRONTUARIO IN(169) AND ATENDIME.CD_ATENDIMENTO = A.CD_ATENDIMENTO) MAMO
FROM ATENDIME A,
     ORI_ATE ORI,
     PACIENTE P,
     CONVENIO C,
     PRESTADOR PRE
WHERE A.CD_MULTI_EMPRESA = 1
--AND A.DT_ATENDIMENTO BETWEEN '11-11-2015' AND '12-11-2015'
AND TO_DATE(A.DT_ATENDIMENTO,'DD/MM/YYYY') BETWEEN TO_DATE(:DT_INICIAL,'DD/MM/YYYY') AND TO_DATE(:DT_FINAL,'DD/MM/YYYY')
--AND A.DS_ORI_ATE LIKE Decode(:DS_ORI_ATE,'TODOS','%',:DS_ORI_ATE)
AND PRE.NM_PRESTADOR LIKE Decode(:NR_PRESTADOR,'TODOS','%',:NR_PRESTADOR)
AND A.CD_ORI_ATE = ORI.CD_ORI_ATE
AND P.CD_PACIENTE = A.CD_PACIENTE
AND A.CD_CONVENIO = C.CD_CONVENIO
AND A.CD_PRESTADOR = PRE.CD_PRESTADOR
ORDER BY A.CD_ORI_ATE,P.NM_PACIENTE