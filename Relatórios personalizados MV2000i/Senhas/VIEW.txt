CREATE OR REPLACE VIEW V_SENHAS_RECEP_AME AS
SELECT TO_DATE(S1.DH_PROCESSO,'DD/MM/YYYY') DH_PROCESSO,
       TA.DS_SENHA SENHA,
       FS.DS_FILA FILA, 
       S1.NM_USUARIO USUARIO,
       (SELECT TO_CHAR(SA.DH_PROCESSO,'HH24:MI') FROM SACR_TEMPO_PROCESSO SA WHERE SA.CD_TRIAGEM_ATENDIMENTO = TA.CD_TRIAGEM_ATENDIMENTO AND SA.CD_TIPO_TEMPO_PROCESSO = 1) TOTEM,
       (SELECT TO_CHAR(SB.DH_PROCESSO,'HH24:MI') FROM SACR_TEMPO_PROCESSO SB WHERE SB.CD_TRIAGEM_ATENDIMENTO = TA.CD_TRIAGEM_ATENDIMENTO AND SB.CD_TIPO_TEMPO_PROCESSO = 20) CHAMADA_PAINEL,
       (SELECT TO_CHAR(SC.DH_PROCESSO,'HH24:MI') FROM SACR_TEMPO_PROCESSO SC WHERE SC.CD_TRIAGEM_ATENDIMENTO = TA.CD_TRIAGEM_ATENDIMENTO AND SC.CD_TIPO_TEMPO_PROCESSO = 21) INICIO_ATENDIMENTO,
       (SELECT TO_CHAR(SD.DH_PROCESSO,'HH24:MI') FROM SACR_TEMPO_PROCESSO SD WHERE SD.CD_TRIAGEM_ATENDIMENTO = TA.CD_TRIAGEM_ATENDIMENTO AND SD.CD_TIPO_TEMPO_PROCESSO = 22) FINAL_ATENDIMENTO
FROM triagem_atendimento TA,
     FILA_SENHA FS,
     SACR_TEMPO_PROCESSO S1
WHERE S1.DH_PROCESSO BETWEEN '01-01-2015' AND '01-08-2015'
AND TA.CD_FILA_SENHA = FS.CD_FILA_SENHA
AND S1.CD_TRIAGEM_ATENDIMENTO = TA.CD_TRIAGEM_ATENDIMENTO
AND S1.CD_TIPO_TEMPO_PROCESSO IN (20)
AND TA.CD_MULTI_EMPRESA = 1
WITH READ ONLY


-------------------------------------

SELECT TO_DATE(S1.DH_PROCESSO,'DD/MM/YYYY') DH_PROCESSO,
       TA.DS_SENHA SENHA,
       FS.DS_FILA FILA,
       S1.NM_USUARIO,
       USU.NM_USUARIO USUARIO,
       (SELECT TO_CHAR(SA.DH_PROCESSO,'HH24:MI') FROM SACR_TEMPO_PROCESSO SA WHERE SA.CD_TRIAGEM_ATENDIMENTO = TA.CD_TRIAGEM_ATENDIMENTO AND SA.CD_TIPO_TEMPO_PROCESSO = 1) TOTEM,
       (SELECT TO_CHAR(SB.DH_PROCESSO,'HH24:MI') FROM SACR_TEMPO_PROCESSO SB WHERE SB.CD_TRIAGEM_ATENDIMENTO = TA.CD_TRIAGEM_ATENDIMENTO AND SB.CD_TIPO_TEMPO_PROCESSO = 20) CHAMADA_PAINEL,
       (SELECT TO_CHAR(SC.DH_PROCESSO,'HH24:MI') FROM SACR_TEMPO_PROCESSO SC WHERE SC.CD_TRIAGEM_ATENDIMENTO = TA.CD_TRIAGEM_ATENDIMENTO AND SC.CD_TIPO_TEMPO_PROCESSO = 21) INICIO_ATENDIMENTO,
       (SELECT TO_CHAR(SD.DH_PROCESSO,'HH24:MI') FROM SACR_TEMPO_PROCESSO SD WHERE SD.CD_TRIAGEM_ATENDIMENTO = TA.CD_TRIAGEM_ATENDIMENTO AND SD.CD_TIPO_TEMPO_PROCESSO = 22) FINAL_ATENDIMENTO
FROM triagem_atendimento TA,
     FILA_SENHA FS,
     SACR_TEMPO_PROCESSO S1,
     DBASGU.USUARIOS USU
WHERE S1.DH_PROCESSO BETWEEN '20-10-2015' AND '25-10-2015'
AND TA.CD_FILA_SENHA = FS.CD_FILA_SENHA
AND S1.CD_TRIAGEM_ATENDIMENTO = TA.CD_TRIAGEM_ATENDIMENTO
AND USU.CD_USUARIO = S1.NM_USUARIO
AND S1.CD_TIPO_TEMPO_PROCESSO IN (20)
AND TA.CD_MULTI_EMPRESA = 1
ORDER BY 1
