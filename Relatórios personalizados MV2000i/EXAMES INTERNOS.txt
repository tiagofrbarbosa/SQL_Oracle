SELECT EXAME,
       SUM(TOTAL),
       SUM(ENCAIXES),
       SUM(MARCADOS),
       SUM(ATENDIDOS)
       FROM(
SELECT 
       ds_item_agendamento "EXAME",COUNT(*) "TOTAL",
       qt_encaixes_marcados "ENCAIXES",
       qt_marcados "MARCADOS",
       SUM(atendimento_realizado) "ATENDIDOS"
FROM(
SELECT
  ac.cd_agenda_central,
  ac.dt_agenda,
  TO_CHAR(ac.hr_inicio,'HH24:MI') hr_inicio,
  TO_CHAR(ac.hr_fim,'HH24:MI') hr_fim,
  ac.qt_atendimento,
  NVL(ac.qt_marcados,0) qt_marcados,
  NVL(ac.qt_encaixes_marcados,0) qt_encaixes_marcados,
  ac.qt_tempo_medio,
  COUNT(itage.cd_atendimento) atendimento_realizado,
  ac.cd_prestador,
  prest.nm_prestador,
  TO_CHAR(itage.hr_agenda,'HH24:MI') hr_agenda,
  itage.cd_paciente,
  itage.nm_paciente,
  itage.nr_fone,
  it.ds_item_agendamento, 
  serv.ds_ser_dis
FROM 
  dbamv.agenda_central ac,
  dbamv.prestador prest,
  dbamv.it_agenda_central itage,
  dbamv.ser_dis serv,
  dbamv.item_agendamento it
WHERE 
    ac.cd_agenda_central   = itage.cd_agenda_central(+)
AND ac.cd_prestador        = prest.cd_prestador(+)
AND itage.cd_item_agendamento = it.cd_item_agendamento
AND itage.cd_ser_dis       = serv.cd_ser_dis(+)
AND TO_DATE(ac.dt_agenda,'DD/MM/YYYY') BETWEEN TO_DATE(:DT_INICIAL,'DD/MM/YYYY') AND TO_DATE(:DT_FINAL,'DD/MM/YYYY')
AND prest.nm_prestador       LIKE Decode(:NR_PRESTADOR,'TODOS','%',:NR_PRESTADOR)
AND it.ds_item_agendamento   LIKE Decode(Trim(:DS_EXAME),'TODOS','%',Trim(:DS_EXAME))
AND it.tp_item IN('I')
AND it.sn_ativo IN('S')
AND ac.cd_usuario != 'ACESSOPEP'
GROUP BY ac.cd_agenda_central,ac.dt_agenda,ac.hr_inicio,ac.hr_fim,ac.qt_atendimento,ac.qt_marcados,ac.qt_encaixes_marcados,ac.qt_tempo_medio,
itage.cd_atendimento,ac.cd_prestador,prest.nm_prestador,itage.hr_agenda,itage.cd_paciente,itage.nm_paciente,itage.nr_fone,it.ds_item_agendamento,serv.ds_ser_dis
ORDER BY itage.hr_agenda ASC
)
GROUP BY ds_item_agendamento,qt_encaixes_marcados,qt_marcados
ORDER BY ds_item_agendamento
)
GROUP BY EXAME
ORDER BY EXAME