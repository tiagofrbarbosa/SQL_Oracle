SELECT CD_CON_PAG,
       DS_CON_PAG,
       CD_FORNECEDOR,
       NM_FANTASIA,
       DS_OBSERVACAO,
       NR_DOCUMENTO,
       DT_EMISSAO,
       DT_VENCIMENTO,
       VL_BRUTO_CONTA,
       TP_QUITACAO,
       CD_DET,
       DS_DET,
       VL_DET,
       CD_SETOR,
       NM_SETOR,
       CD_REDUZIDO,
       DS_CONTA,
       CD_ITEM_RES,
       DS_ITEM_RES,
       VL_LIQUIDO
FROM(
select 
DISTINCT(CON.CD_CON_PAG), 
CON.DS_CON_PAG, 
forn.cd_fornecedor,
forn.nm_fantasia,
CON.ds_observacao,
CON.NR_DOCUMENTO,
CON.DT_EMISSAO,
IT.DT_VENCIMENTO,
CON.VL_BRUTO_CONTA,
DECODE(IT.TP_QUITACAO, 'V', 'Prev', 'Q', 'Quit', 'P', 'Parc', 'C', 'Comp','T','DevT', 'L', 'DevP') TP_QUITACAO,
TIP.CD_DETALHAMENTO CD_DET,
DET.DS_DETALHAMENTO DS_DET,
TIP.VL_DETALHAMENTO VL_DET,
SETOR.CD_SETOR,
SETOR.NM_SETOR,
RAT.CD_REDUZIDO,
PC.DS_CONTA,
rat.cd_item_res,
res.ds_item_res,
CON.VL_BRUTO_CONTA - (select sum(vl_detalhamento) from con_pag, itcon_pag, tip_detcon_pag, TIP_DETALHE where DT_EMISSAO BETWEEN '30/06/2015' AND '01/07/2015' and CON_PAG.cd_multi_empresa = 1 AND CON_PAG.CD_CON_PAG = ITCON_PAG.CD_CON_PAG AND CON_PAG.CD_CON_PAG = TIP_DETCON_PAG.CD_CON_PAG_PAI AND TIP_DETCON_PAG.CD_DETALHAMENTO = TIP_DETALHE.CD_DETALHAMENTO AND CON_PAG.CD_CON_PAG = CON.CD_CON_PAG) VL_LIQUIDO
from 
con_pag CON,
itcon_pag IT,
tip_detcon_pag TIP,
TIP_DETALHE DET,
ratcon_pag RAT,
SETOR,
PLANO_CONTAS PC,
item_res res,
FORNECEDOR forn 
where CON.DT_EMISSAO BETWEEN '30/06/2015' AND '01/07/2015'
and CON.cd_multi_empresa = 1
AND CON.CD_CON_PAG = IT.CD_CON_PAG
AND CON.CD_CON_PAG = TIP.CD_CON_PAG_PAI
AND TIP.CD_DETALHAMENTO = DET.CD_DETALHAMENTO
AND RAT.CD_CON_PAG = CON.CD_CON_PAG
AND RAT.CD_SETOR = SETOR.CD_SETOR
AND RAT.CD_REDUZIDO = PC.CD_REDUZIDO
AND TIP.CD_CON_PAG_PAI = rat.CD_CON_PAG
AND rat.cd_item_res = res.cd_item_res
and con.cd_fornecedor = forn.cd_fornecedor

UNION ALL

select 
CON.CD_CON_PAG, 
CON.DS_CON_PAG, 
forn.cd_fornecedor,
forn.nm_fantasia,
CON.ds_observacao,
CON.NR_DOCUMENTO,
CON.DT_EMISSAO,
IT.DT_VENCIMENTO,
CON.VL_BRUTO_CONTA,
DECODE(IT.TP_QUITACAO, 'V', 'Prev', 'Q', 'Quit', 'P', 'Parc', 'C', 'Comp','T','DevT', 'L', 'DevP') TP_QUITACAO,
null CD_DET,
null DS_DET,
null VL_DET,
SETOR.CD_SETOR,
SETOR.NM_SETOR,
RAT.CD_REDUZIDO,
PC.DS_CONTA,
rat.cd_item_res,
res.ds_item_res,
CON.VL_BRUTO_CONTA - (select sum(vl_detalhamento) from con_pag, itcon_pag, tip_detcon_pag, TIP_DETALHE where DT_EMISSAO BETWEEN '30/06/2015' AND '01/07/2015' and CON_PAG.cd_multi_empresa = 1 AND CON_PAG.CD_CON_PAG = ITCON_PAG.CD_CON_PAG AND CON_PAG.CD_CON_PAG = TIP_DETCON_PAG.CD_CON_PAG_PAI AND TIP_DETCON_PAG.CD_DETALHAMENTO = TIP_DETALHE.CD_DETALHAMENTO AND CON_PAG.CD_CON_PAG = CON.CD_CON_PAG) VL_LIQUIDO
from 
con_pag CON,
itcon_pag IT,
--tip_detcon_pag TIP,
--TIP_DETALHE DET,
ratcon_pag RAT,
SETOR,
PLANO_CONTAS PC,
item_res res,
fornecedor forn
where CON.DT_EMISSAO BETWEEN '30/06/2015' AND '01/07/2015'
and CON.cd_multi_empresa = 1
AND CON.CD_CON_PAG = IT.CD_CON_PAG
--AND CON.CD_CON_PAG = TIP.CD_CON_PAG_PAI
--AND TIP.CD_DETALHAMENTO = DET.CD_DETALHAMENTO
AND RAT.CD_CON_PAG = CON.CD_CON_PAG
AND RAT.CD_SETOR = SETOR.CD_SETOR
AND RAT.CD_REDUZIDO = PC.CD_REDUZIDO
--AND TIP.CD_CON_PAG_PAI = rat.CD_CON_PAG
AND rat.cd_item_res = res.cd_item_res
and con.cd_fornecedor = forn.cd_fornecedor
AND CON.CD_CON_PAG NOT IN(
          select 
                  CON.CD_CON_PAG
                    from 
                  con_pag CON,
                  itcon_pag IT,
                  tip_detcon_pag TIP,
                  TIP_DETALHE DET,
                  ratcon_pag RAT,
                  SETOR,
                  PLANO_CONTAS PC,
                  item_res res
                  where CON.DT_EMISSAO BETWEEN '30/06/2015' AND '01/07/2015'
                  and CON.cd_multi_empresa = 1
                  AND CON.CD_CON_PAG = IT.CD_CON_PAG
                  AND CON.CD_CON_PAG = TIP.CD_CON_PAG_PAI
                  AND TIP.CD_DETALHAMENTO = DET.CD_DETALHAMENTO
                  AND RAT.CD_CON_PAG = CON.CD_CON_PAG
                  AND RAT.CD_SETOR = SETOR.CD_SETOR
                  AND RAT.CD_REDUZIDO = PC.CD_REDUZIDO
                  AND TIP.CD_CON_PAG_PAI = rat.CD_CON_PAG
                  AND rat.cd_item_res = res.cd_item_res
                        )

)
ORDER BY CD_CON_PAG
 

